# NGINX config for Meralda .htaccess rules

# 1. service/.htaccess (empty, no effect)

# 2. service/hello/.htaccess
location /service/hello/ {
    try_files $uri $uri/ /service/hello/service.php?$args;
}

# 3. cronjobs/.htaccess
location /cronjobs/ {
    allow ::1;
    deny all;
}

# 4. get/.htaccess
location /get/ {
    rewrite ^/get/(.*)$ /appcmd/dosubmancmd.php last;
}

# 5. kcfinder/*/.htaccess (lang, lib, tpl, integration, core, conf, cache)
location ~ ^/kcfinder/(lang|lib|tpl|integration|core|conf|cache)/ {
    deny all;
}

# 6. kcfinder/lib/.htaccess (deny all)
# 7. kcfinder/tpl/.htaccess (deny all)
# 8. kcfinder/integration/.htaccess (deny all)
# 9. kcfinder/core/.htaccess (deny all)
# 10. kcfinder/conf/.htaccess (deny all)
# 11. kcfinder/cache/.htaccess (deny all)
# (All covered by the above regex location)

# 12. kcfinder/lang/.htaccess (deny all)
location ~ ^/kcfinder/lang/ {
    deny all;
}

# 13. kcfinder/upload/.htaccess
location /kcfinder/upload/ {
    # Block script execution for sensitive extensions
    location ~* \.(cgi|pl|py|pyc|pyo|phtml|php|php3|php4|php5|php6|pcgi|pcgi3|pcgi4|pcgi5|pchi6|inc)$ {
        deny all;
    }
    # Serve .html and .htm as plain text
    types {
        text/plain html htm;
    }
    default_type application/octet-stream;
}

